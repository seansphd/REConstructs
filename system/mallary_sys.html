<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRPL System Visualization</title>
    <style>
        /* Reset default browser spacing and set box sizing */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* General body styling */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            padding: 20px;
            background: #f5f5f5;
        }

        /* Central container for all content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Section containing sliders/inputs */
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        /* Each individual control (label + input + value) */
        .control-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* Sliders */
        input[type="range"] {
            width: 100%;
        }

        /* Canvas wrapper (bordered box) */
        .canvas-container {
            position: relative;
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }

        /* Canvas itself */
        canvas {
            display: block;
            background: white;
        }

        /* Information panel below canvas */
        .info-panel {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        /* Parameter values shown beside sliders */
        .parameter-value {
            font-family: monospace;
            color: #666;
        }

        /* Button styling (not currently used) */
        button {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TRPL System Visualization</h1>
        
        <!-- Controls: sliders for adjusting system parameters -->
        <div class="controls">
            <div class="control-group">
                <label for="resolution">Resolution (steps/inch)</label>
                <input type="range" id="resolution" min="100" max="200" value="100">
                <span class="parameter-value" id="resolution-value">100</span>
            </div>
            
            <div class="control-group">
                <label for="ymod">Height (YMOD)</label>
                <input type="range" id="ymod" min="100" max="500" value="300">
                <span class="parameter-value" id="ymod-value">300</span>
            </div>
            
            <div class="control-group">
                <label for="wide">Width (WIDE)</label>
                <input type="range" id="wide" min="100" max="500" value="300">
                <span class="parameter-value" id="wide-value">300</span>
            </div>
            
            <div class="control-group">
                <label for="xmod">Interpolation Count (XMOD)</label>
                <input type="range" id="xmod" min="5" max="50" value="20">
                <span class="parameter-value" id="xmod-value">20</span>
            </div>
        </div>

        <!-- Canvas where the visualisation is drawn -->
        <div class="canvas-container">
            <canvas id="plotterCanvas"></canvas>
        </div>

        <!-- Dynamic information panel that displays current parameter states -->
        <div class="info-panel">
            <h2>System Parameters</h2>
            <div id="systemInfo"></div>
        </div>
    </div>

    <script>
        /* 
           TRPLSystem: main class controlling the drawing of the system
           Handles resizing, drawing grid, plotting moirÃ©-like pattern,
           and updating info panel
        */
        class TRPLSystem {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');

                // Default parameter values
                this.resolution = 100;  // grid density
                this.ymod = 300;        // vertical scale
                this.wide = 300;        // horizontal scale
                this.xmod = 20;         // number of interpolation points

                this.initialize();
            }

            initialize() {
                // Set up canvas size on load and on window resize
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                
                // Draw the initial state
                this.draw();
            }

            resizeCanvas() {
                // Resize canvas to fit parent container, maintaining aspect ratio
                const container = this.canvas.parentElement;
                this.canvas.width = container.clientWidth;
                this.canvas.height = Math.min(container.clientWidth * 0.75, 600);
                this.draw();
            }

            updateParameters(params) {
                // Update given parameters dynamically and redraw
                Object.assign(this, params);
                this.draw();
            }

            calculateMoirePattern() {
                // Generate list of points for the base pattern
                const points = [];
                const step = this.canvas.width / this.resolution;
                
                for (let i = 0; i < this.xmod; i++) {
                    const x = (i / (this.xmod - 1)) * this.wide;
                    const y = Math.sin(x * Math.PI / 180) * this.ymod;
                    points.push({ x, y });
                }

                return points;
            }

            draw() {
                // Clear canvas before redrawing
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Transformations from data space to canvas space
                const scaleX = this.canvas.width / this.wide;
                const scaleY = this.canvas.height / (this.ymod * 2);
                const offsetY = this.canvas.height / 2;

                // Draw background grid
                this.drawGrid();

                // Base pattern points
                const points = this.calculateMoirePattern();
                
                // Draw main line
                this.ctx.beginPath();
                this.ctx.strokeStyle = '#007bff';
                this.ctx.lineWidth = 1;

                points.forEach((point, i) => {
                    const x = point.x * scaleX;
                    const y = offsetY + point.y * scaleY;
                    
                    if (i === 0) {
                        this.ctx.moveTo(x, y);
                    } else {
                        this.ctx.lineTo(x, y);
                    }
                });
                this.ctx.stroke();

                // Draw offset interpolated lines for visual effect
                for (let offset = 1; offset <= 3; offset++) {
                    this.ctx.beginPath();
                    this.ctx.strokeStyle = `rgba(0, 123, 255, ${0.3 - offset * 0.1})`;
                    
                    points.forEach((point, i) => {
                        const x = point.x * scaleX;
                        const y = offsetY + (point.y + offset * 50) * scaleY;
                        
                        if (i === 0) {
                            this.ctx.moveTo(x, y);
                        } else {
                            this.ctx.lineTo(x, y);
                        }
                    });
                    this.ctx.stroke();
                }

                // Update info panel
                this.updateSystemInfo();
            }

            drawGrid() {
                // Draw background grid lines
                const step = this.canvas.width / this.resolution;
                
                this.ctx.beginPath();
                this.ctx.strokeStyle = '#eee';
                this.ctx.lineWidth = 0.5;

                // Vertical grid lines
                for (let x = 0; x <= this.canvas.width; x += step) {
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                }

                // Horizontal grid lines
                for (let y = 0; y <= this.canvas.height; y += step) {
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                }

                this.ctx.stroke();
            }

            updateSystemInfo() {
                // Display current system parameters in the info panel
                const info = document.getElementById('systemInfo');
                info.innerHTML = `
                    <p>Current System State:</p>
                    <ul>
                        <li>Resolution: ${this.resolution} steps/inch</li>
                        <li>Grid Size: ${this.canvas.width}x${this.canvas.height} pixels</li>
                        <li>Interpolation Points: ${this.xmod}</li>
                        <li>Pattern Height: ${this.ymod}</li>
                        <li>Pattern Width: ${this.wide}</li>
                    </ul>
                `;
            }
        }

        // Initialise system instance with canvas
        const canvas = document.getElementById('plotterCanvas');
        const system = new TRPLSystem(canvas);

        // Grab control elements
        const controls = {
            resolution: document.getElementById('resolution'),
            ymod: document.getElementById('ymod'),
            wide: document.getElementById('wide'),
            xmod: document.getElementById('xmod')
        };

        // Link controls to system parameters
        Object.entries(controls).forEach(([key, control]) => {
            const valueDisplay = document.getElementById(`${key}-value`);
            valueDisplay.textContent = control.value;
            
            // When user moves slider, update both display and system
            control.addEventListener('input', (e) => {
                valueDisplay.textContent = e.target.value;
                const params = {};
                params[key] = parseInt(e.target.value);
                system.updateParameters(params);
            });
        });
    </script>
</body>
</html>
